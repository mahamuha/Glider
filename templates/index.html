<!DOCTYPE html>
<html>
<head>
    <title>Glider</title>
    <!-- Import custom font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Arial&display=swap" rel="stylesheet">

    <!-- Internal styles for layout and visual appearance -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: url("/static/techno_bg.jpg") no-repeat center center fixed;
            background-size: cover;
            color: #fff;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            box-sizing: border-box;
        }

        h1, h2 {
            text-align: center;
            margin-bottom: 10px;
        }

        .welcome {
            margin-bottom: 20px;
        }

        .logout {
            color: #58d68d;
            text-decoration: none;
        }

        form, ul {
            margin: 20px 0;
            text-align: center;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
        }

        button {
            padding: 5px 10px;
            border-radius: 5px;
            border: none;
            background-color: #58d68d;
            color: black;
            cursor: pointer;
        }

        input, select {
            padding: 5px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        img {
            max-width: 300px;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px #58d68d;
        }

        .error {
            color: #ff7b7b;
            background: rgba(255, 0, 0, 0.2);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
<div class="container">

    <!-- Welcome message showing current username -->
    <h1>üåø Glider ‚Äî –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ current_user.username }}</h1>

    <!-- Logout link -->
    <div class="welcome">
        <a href="/logout" class="logout">–í—ã–π—Ç–∏</a>
    </div>

    <!-- Display error message if exists -->
    {% if error %}
        <div class="error">{{ error }}</div>
    {% endif %}

    <!-- Form to create a new task group -->
    <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É –∑–∞–¥–∞—á</h2>
    <form action="/create-group" method="post">
        <input type="text" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" required>
        <button type="submit">–°–æ–∑–¥–∞—Ç—å</button>
    </form>

    <!-- Form to select a group from existing ones -->
    <form method="get" action="/">
        <label for="group-select">–í—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É:</label>
        <select name="group_id" id="group-select" onchange="this.form.submit()">
            <option value="" {% if not selected_group %}selected{% endif %}>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏</option>
            {% for group in groups %}
                <option value="{{ group.id }}" {% if selected_group and group.id == selected_group.id %}selected{% endif %}>
                    {{ group.name }}
                </option>
            {% endfor %}
        </select>
    </form>

    {% if selected_group %}
        <!-- Form to set a goal for the selected group -->
        <form action="/set-group-goal" method="post">
            <input type="hidden" name="group_id" value="{{ selected_group.id }}">
            <label>–¶–µ–ª—å –∑–∞–¥–∞—á –¥–ª—è –≥—Ä—É–ø–ø—ã:</label>
            <input type="number" name="goal" min="1" value="{{ selected_group.goal or 3 }}">
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
    {% else %}
        <!-- Form to set a personal goal if no group is selected -->
        <form action="/set-user-goal" method="post">
            <label>–õ–∏—á–Ω–∞—è —Ü–µ–ª—å –∑–∞–¥–∞—á:</label>
            <input type="number" name="goal" min="1" value="{{ current_user.goal or 1 }}">
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </form>
    {% endif %}

    <!-- Form to add a new task (for group or personal) -->
    <form action="/add-task" method="post">
        <input type="text" name="title" placeholder="–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞" required>
        <input type="hidden" name="group_id" value="{{ selected_group.id if selected_group else '' }}">
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>

    <!-- List of tasks with completion button -->
    <ul>
        {% for task in tasks %}
        <li>
            {{ task.title }} ‚Äî –î–æ–±–∞–≤–∏–ª:
            {% for user in users %}
                {% if user.id == task.user_id %}
                    <strong>{{ user.username }}</strong>
                {% endif %}
            {% endfor %}
            ‚Äî –°—Ç–∞—Ç—É—Å:
            {% if task.completed %}
                <em>–í—ã–ø–æ–ª–Ω–µ–Ω–∞</em>
            {% else %}
                <form method="post" action="/complete-task/{{ task.id }}" style="display:inline;">
                    <button type="submit">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                </form>
            {% endif %}
        </li>
        {% endfor %}
    </ul>

    <!-- Visual plant growth indicator based on goal completion -->
    <img src="/static/{{ plant_image }}" alt="–≠—Ç–∞–ø —Ä–æ—Å—Ç–∞ —Ä–∞—Å—Ç–µ–Ω–∏—è">
    <p>
        {% if plant_growth >= 100 %}
            –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –¶–µ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∞! üéâ
        {% else %}
            –ü—Ä–æ–≥—Ä–µ—Å—Å —Ä–æ—Å—Ç–∞: {{ plant_growth }}%
        {% endif %}
    </p>

</div>
</body>
</html>
